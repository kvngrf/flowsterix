{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "tour-hud",
  "type": "registry:block",
  "title": "Tour HUD",
  "description": "Complete heads-up display with SVG spotlight overlay, smart popover positioning, blur effects, and navigation controls.",
  "dependencies": [
    "@flowsterix/react",
    "motion",
    "@floating-ui/dom"
  ],
  "registryDependencies": [
    "https://flowsterix.com/r/tour-provider.json",
    "https://flowsterix.com/r/tour-controls.json",
    "https://flowsterix.com/r/tour-popover-handle.json",
    "https://flowsterix.com/r/tour-progress.json",
    "https://flowsterix.com/r/mobile-drawer.json",
    "https://flowsterix.com/r/step-content.json",
    "button"
  ],
  "files": [
    {
      "path": "registry/flowsterix/blocks/tour-hud.tsx",
      "content": "'use client'\n\nimport type { Step, StepPlacement } from '@flowsterix/core'\nimport type { UseHudShortcutsOptions } from '@flowsterix/react'\nimport {\n  OverlayBackdrop,\n  TourFocusManager,\n  TourPopoverPortal,\n  useHudMotion,\n  useTourHud,\n  useTourOverlay,\n} from '@flowsterix/react'\nimport { AnimatePresence, motion } from 'motion/react'\nimport * as React from 'react'\nimport { createPortal } from 'react-dom'\n\nimport { cn } from '@/lib/utils'\nimport {\n  MobileDrawer,\n  type MobileDrawerSnapPoint,\n} from '@/registry/flowsterix/mobile-drawer'\nimport { TourControls } from '@/registry/flowsterix/tour-controls'\nimport { TourPopoverHandle } from '@/registry/flowsterix/tour-popover-handle'\nimport { TourProgress } from '@/registry/flowsterix/tour-progress'\n\n// =============================================================================\n// Constants\n// =============================================================================\n\nconst MOBILE_BREAKPOINT = 640\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface TourHUDProps {\n  /** Additional class names for the popover */\n  className?: string\n  /** Overlay configuration */\n  overlay?: {\n    /** Padding around the highlighted target (default: 12) */\n    padding?: number\n    /** Border radius of the highlight cutout (default: 12) */\n    radius?: number\n    /** Background color of the overlay */\n    backdropColor?: string\n    /** Backdrop blur amount in pixels (default: 6) */\n    blurAmount?: number\n    /** Opacity of the backdrop (default: 1) */\n    opacity?: number\n    /** Whether to show the highlight ring (default: true) */\n    showRing?: boolean\n    /** Custom box-shadow for the highlight ring */\n    ringShadow?: string\n    /** Z-index for the overlay (default: 2000) */\n    zIndex?: number\n  }\n  /** Popover configuration */\n  popover?: {\n    /** Offset distance from the target (default: 32) */\n    offset?: number\n    /** Preferred placement relative to target */\n    placement?: StepPlacement\n    /** Fixed width for the popover */\n    width?: number | string\n    /** Maximum width for the popover (default: 360) */\n    maxWidth?: number | string\n    /** Z-index for the popover (default: 2002) */\n    zIndex?: number\n    /** Additional class names for the popover container */\n    className?: string\n    /** Additional class names for the content wrapper */\n    contentClassName?: string\n    /** Whether to show the drag handle (default: true) */\n    showDragHandle?: boolean\n  }\n  /** Controls configuration */\n  controls?: {\n    /** Whether to show the skip button (default: true) */\n    showSkip?: boolean\n    /** Skip button mode: 'click' for instant skip, 'hold' for hold-to-confirm (default: 'click') */\n    skipMode?: 'click' | 'hold'\n    /** Duration in ms to hold skip button when skipMode is 'hold' (default: 1000) */\n    skipHoldDurationMs?: number\n    /** Custom labels for buttons */\n    labels?: {\n      back?: string\n      next?: string\n      finish?: string\n      skip?: string\n    }\n    /** Button variant for primary action */\n    primaryVariant?: 'default' | 'secondary' | 'outline' | 'ghost'\n    /** Button variant for secondary actions */\n    secondaryVariant?: 'default' | 'secondary' | 'outline' | 'ghost'\n    /** Additional class names for the controls container */\n    className?: string\n  }\n  /** Progress indicator configuration */\n  progress?: {\n    /** Whether to show progress indicator (default: true) */\n    show?: boolean\n    /** Progress variant */\n    variant?: 'dots' | 'bar' | 'fraction' | 'steps'\n    /** Position within the popover */\n    position?: 'top' | 'bottom'\n    /** Size of the progress indicator */\n    size?: 'sm' | 'md' | 'lg'\n  }\n  /** Keyboard shortcut configuration */\n  shortcuts?: boolean | UseHudShortcutsOptions\n  /** Mobile drawer configuration */\n  mobile?: {\n    /** Enable mobile drawer (default: true) */\n    enabled?: boolean\n    /** Breakpoint in pixels for mobile detection (default: 640) */\n    breakpoint?: number\n    /** Default snap point when drawer opens (default: 'expanded') */\n    defaultSnapPoint?: MobileDrawerSnapPoint\n    /** Available snap points (default: ['minimized', 'expanded']) */\n    snapPoints?: MobileDrawerSnapPoint[]\n    /** Whether user can minimize the drawer (default: true) */\n    allowMinimize?: boolean\n    /** Maximum height as ratio of viewport (default: 0.85). Drawer auto-sizes to content up to this max. */\n    maxHeightRatio?: number\n    /** Callback when snap point changes */\n    onSnapPointChange?: (point: MobileDrawerSnapPoint) => void\n  }\n  /** Custom content to render inside the popover (overrides step content) */\n  children?: React.ReactNode\n  /** Custom step content renderer */\n  renderContent?: (step: Step<React.ReactNode>) => React.ReactNode\n}\n\n// =============================================================================\n// Hooks\n// =============================================================================\n\nfunction useIsMobile(breakpoint: number = MOBILE_BREAKPOINT) {\n  const [isMobile, setIsMobile] = React.useState(false)\n\n  React.useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth <= breakpoint)\n    }\n\n    checkMobile()\n    window.addEventListener('resize', checkMobile)\n    return () => window.removeEventListener('resize', checkMobile)\n  }, [breakpoint])\n\n  return isMobile\n}\n\n// =============================================================================\n// Main Component\n// =============================================================================\n\n/**\n * A complete heads-up display combining overlay, popover, controls, and progress.\n * This is the recommended starting point for most tour implementations.\n *\n * Features:\n * - SVG mask-based spotlight overlay with smooth spring animations\n * - Backdrop blur and highlight ring effects\n * - Smart popover positioning with floating/docked/mobile layouts\n * - Focus management for accessibility\n * - Step progress indicator\n * - Navigation controls with proper state management\n *\n * @example\n * ```tsx\n * import { TourProvider } from \"@/components/tour/tour-provider\"\n * import { TourHUD } from \"@/components/tour/blocks/tour-hud\"\n * import { myFlow } from \"@/lib/tours/my-flow\"\n *\n * export function App() {\n *   return (\n *     <TourProvider flows={[myFlow]}>\n *       <TourHUD\n *         overlay={{ padding: 12, showRing: true, blurAmount: 6 }}\n *         popover={{ maxWidth: 360 }}\n *         progress={{ show: true, variant: \"dots\" }}\n *       />\n *       <YourApp />\n *     </TourProvider>\n *   )\n * }\n * ```\n */\nexport function TourHUD({\n  className,\n  overlay = { showRing: true, blurAmount: 6, zIndex: 2000, opacity: 1 },\n  popover = {},\n  controls = {},\n  progress = { show: false, variant: 'dots', position: 'bottom', size: 'sm' },\n  shortcuts = { escape: false },\n  mobile = {},\n  children,\n  renderContent,\n}: TourHUDProps) {\n  const isBrowser =\n    typeof window !== 'undefined' && typeof document !== 'undefined'\n  const portalTarget = isBrowser ? document.body : null\n\n  // Mobile configuration (before useTourHud so we can pass scrollLockBottomInset)\n  const mobileEnabled = mobile.enabled !== false\n  const mobileBreakpoint = mobile.breakpoint ?? MOBILE_BREAKPOINT\n  const isMobileViewport = useIsMobile(mobileBreakpoint)\n  const shouldRenderMobile = mobileEnabled && isMobileViewport\n\n  // Track drawer height for scroll lock inset\n  const [drawerHeight, setDrawerHeight] = React.useState(0)\n\n  const hud = useTourHud({\n    shortcuts,\n    scrollLockBottomInset: shouldRenderMobile ? drawerHeight : 0,\n  })\n  const {\n    hudState,\n    popover: popoverConfig,\n    description,\n    focusManager,\n    targetIssue,\n    overlay: overlayConfig,\n    isConstrainedScrollActive,\n  } = hud\n  const {\n    runningStep,\n    shouldRender,\n    hudTarget,\n    hudRenderMode,\n    activeFlowId,\n    isInGracePeriod,\n  } = hudState\n\n  // Enable HUD for headless flows (hud: { render: 'none' }) or default flows\n  const isHeadlessFlow = hudRenderMode === 'none' && Boolean(activeFlowId)\n  const isDefaultFlow = hudRenderMode !== 'none' && shouldRender\n  const hudEnabled = (isHeadlessFlow || isDefaultFlow) && shouldRender\n\n  const { components, transitions } = useHudMotion()\n  const { MotionDiv, MotionSection } = components\n  const {\n    highlight: highlightTransition,\n    overlayFade: overlayFadeTransition,\n    popoverEntrance: popoverEntranceTransition,\n    popoverExit: popoverExitTransition,\n    popoverContent: popoverContentTransition,\n  } = transitions\n\n  // Overlay configuration with defaults\n  const overlayPadding = overlay.padding ?? overlayConfig.padding ?? 12\n  const overlayRadius = overlay.radius ?? overlayConfig.radius ?? 12\n  const overlayZIndex = overlay.zIndex\n  const overlayColor = overlay.backdropColor ?? 'rgba(0, 0, 0, 0.5)'\n  const overlayBlur = overlay.blurAmount\n  const overlayOpacity = overlay.opacity\n  const showRing = overlay.showRing\n  const ringShadow =\n    overlay.ringShadow ??\n    '0 0 0 2px hsl(var(--primary)), 0 0 20px hsl(var(--primary) / 0.5)'\n\n  // Compute overlay geometry\n  const overlayGeometry = useTourOverlay({\n    target: hudTarget,\n    padding: overlayPadding,\n    radius: overlayRadius,\n    interactionMode: overlayConfig.interactionMode,\n    isInGracePeriod,\n  })\n\n  // Popover configuration with defaults\n  const popoverOffset = popover.offset ?? popoverConfig.offset\n  const popoverPlacement =\n    runningStep?.placement ??\n    popover.placement ??\n    popoverConfig.placement ??\n    'bottom'\n  const popoverWidth = popover.width ?? popoverConfig.width\n  const popoverMaxWidth = popover.maxWidth ?? popoverConfig.maxWidth ?? 360\n  const popoverZIndex = popover.zIndex ?? 2002\n\n  if (!hudEnabled || !runningStep) return null\n  if (!portalTarget) return null\n\n  const stepContent = renderContent\n    ? renderContent(runningStep)\n    : runningStep.content\n\n  return createPortal(\n    <div data-tour-hud=\"\">\n      {/* Focus management for accessibility */}\n      <TourFocusManager\n        active={focusManager.active}\n        target={focusManager.target}\n        popoverNode={focusManager.popoverNode}\n        highlightRect={overlayGeometry.highlight.rect}\n        guardElementFocusRing={focusManager.guardElementFocusRing}\n      />\n\n      {/* Spotlight overlay with SVG masking and animations */}\n      <OverlayBackdrop\n        overlay={overlayGeometry}\n        zIndex={overlayZIndex}\n        color={overlayColor}\n        opacity={overlayOpacity}\n        blurAmount={overlayBlur}\n        shadow={showRing ? ringShadow : undefined}\n        transitionsOverride={{\n          overlayHighlight: isConstrainedScrollActive\n            ? { type: 'tween', duration: 0 }\n            : highlightTransition,\n          overlayFade: overlayFadeTransition,\n        }}\n      />\n\n      {/* Mobile drawer or desktop popover */}\n      {shouldRenderMobile ? (\n        <MobileDrawer\n          defaultSnapPoint={mobile.defaultSnapPoint ?? 'expanded'}\n          snapPoints={mobile.snapPoints ?? ['minimized', 'expanded']}\n          allowMinimize={mobile.allowMinimize ?? true}\n          maxHeightRatio={mobile.maxHeightRatio}\n          onSnapPointChange={mobile.onSnapPointChange}\n          onDrawerHeightChange={setDrawerHeight}\n          className={className}\n          controls={{\n            showSkip: controls.showSkip,\n            skipMode: controls.skipMode,\n            skipHoldDurationMs: controls.skipHoldDurationMs,\n            labels: controls.labels,\n            primaryVariant: controls.primaryVariant,\n            secondaryVariant: controls.secondaryVariant,\n            className: controls.className,\n          }}\n          progress={{\n            show: progress.show,\n            variant: progress.variant,\n            size: progress.size,\n          }}\n          stepKey={runningStep.id}\n        >\n          {/* Step content */}\n          <div className=\"space-y-3\">\n            {children ?? stepContent}\n\n            {/* Target issue warning */}\n            {targetIssue.issue && (\n              <div\n                className=\"mt-3 p-3 rounded-lg bg-red-50 border border-red-300 text-red-700\"\n                role=\"status\"\n                aria-live=\"polite\"\n              >\n                <strong className=\"block mb-1\">\n                  {targetIssue.issue.title}\n                </strong>\n                <p className=\"text-sm leading-relaxed\">\n                  {targetIssue.issue.body}\n                </p>\n                {targetIssue.issue.hint && (\n                  <p className=\"mt-1 text-xs opacity-90\">\n                    {targetIssue.issue.hint}\n                  </p>\n                )}\n              </div>\n            )}\n          </div>\n        </MobileDrawer>\n      ) : (\n        <AnimatePresence>\n          <TourPopoverPortal\n            target={hudTarget}\n            offset={popoverOffset}\n            placement={popoverPlacement}\n            width={popoverWidth}\n            maxWidth={popoverMaxWidth}\n            zIndex={popoverZIndex}\n            role={popoverConfig.role}\n            ariaModal={Boolean(popoverConfig.ariaModal)}\n            ariaLabel={popoverConfig.ariaLabel}\n            ariaDescribedBy={description.combinedAriaDescribedBy}\n            descriptionId={description.descriptionId}\n            descriptionText={description.text ?? undefined}\n            onContainerChange={focusManager.setPopoverNode}\n            containerComponent={MotionSection}\n            contentComponent={MotionDiv}\n            layoutId=\"popover\"\n            isInGracePeriod={isInGracePeriod}\n            transitionsOverride={{\n              popoverEntrance: popoverEntranceTransition,\n              popoverExit: popoverExitTransition,\n              popoverContent: popoverContentTransition,\n            }}\n          >\n            {({\n              Container,\n              Content,\n              containerProps,\n              contentProps,\n              descriptionProps,\n              layoutMode,\n              dragHandleProps,\n              isDragging,\n            }) => {\n              const { key: contentKey, ...restContentProps } = contentProps\n              const shouldShowHandle = popover.showDragHandle ?? true\n              const showHandleInLayout =\n                layoutMode === 'docked' || layoutMode === 'manual'\n              return (\n                <Container\n                  {...containerProps}\n                  className={cn(\n                    'rounded-xl border bg-popover text-popover-foreground shadow-lg',\n                    popover.className,\n                    className,\n                  )}\n                >\n                  {/* Screen reader description */}\n                  {descriptionProps.id && descriptionProps.text && (\n                    <span id={descriptionProps.id} className=\"sr-only\">\n                      {descriptionProps.text}\n                    </span>\n                  )}\n\n                  <motion.div\n                    className=\"relative overflow-hidden\"\n                    data-tour-popover-shell=\"\"\n                  >\n                    {shouldShowHandle && showHandleInLayout ? (\n                      <TourPopoverHandle\n                        dragHandleProps={dragHandleProps}\n                        isDragging={isDragging}\n                      />\n                    ) : null}\n                    <AnimatePresence mode=\"popLayout\">\n                      <Content\n                        key={contentKey}\n                        {...restContentProps}\n                        className={cn(\n                          'p-4 space-y-3 overflow-hidden',\n                          popover.contentClassName,\n                        )}\n                      >\n                        {/* Progress indicator (top position) */}\n                        {progress.show && progress.position === 'top' && (\n                          <TourProgress\n                            variant={progress.variant}\n                            size={progress.size}\n                          />\n                        )}\n\n                        {/* Step content */}\n                        <motion.div layout=\"position\">\n                          {children ?? stepContent}\n                        </motion.div>\n\n                        {/* Target issue warning */}\n                        {targetIssue.issue && (\n                          <div\n                            className=\"mt-3 p-3 rounded-lg bg-red-50 border border-red-300 text-red-700\"\n                            role=\"status\"\n                            aria-live=\"polite\"\n                          >\n                            <strong className=\"block mb-1\">\n                              {targetIssue.issue.title}\n                            </strong>\n                            <p className=\"text-sm leading-relaxed\">\n                              {targetIssue.issue.body}\n                            </p>\n                            {targetIssue.issue.hint && (\n                              <p className=\"mt-1 text-xs opacity-90\">\n                                {targetIssue.issue.hint}\n                              </p>\n                            )}\n                          </div>\n                        )}\n\n                        {/* Progress indicator (bottom position - default) */}\n                        {progress.show && progress.position !== 'top' && (\n                          <TourProgress\n                            variant={progress.variant}\n                            size={progress.size}\n                          />\n                        )}\n                      </Content>\n                    </AnimatePresence>\n                    <TourControls\n                      showSkip={controls.showSkip}\n                      skipMode={controls.skipMode}\n                      skipHoldDurationMs={controls.skipHoldDurationMs}\n                      labels={controls.labels}\n                      primaryVariant={controls.primaryVariant}\n                      secondaryVariant={controls.secondaryVariant}\n                      className={controls.className}\n                    />\n                  </motion.div>\n                </Container>\n              )\n            }}\n          </TourPopoverPortal>\n        </AnimatePresence>\n      )}\n    </div>,\n    portalTarget,\n  )\n}\n",
      "type": "registry:component"
    }
  ],
  "categories": [
    "tour",
    "block"
  ]
}